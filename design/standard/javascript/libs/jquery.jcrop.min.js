/**
 * jquery.Jcrop.min.js v0.9.10 (build:20121207)
 * jQuery Image Cropping Plugin - released under MIT License
 * Copyright (c) 2008-2012 Tapmodo Interactive LLC
 * https://github.com/tapmodo/Jcrop
 */
(function(e){typeof define=="function"&&define.amd?define(["jquery"],e):e(jQuery)})(function(e){e.Jcrop=function(t,n){function u(e){return Math.round(e)+"px"}function a(e){return r.baseClass+"-"+e}function f(){return e.fx.step.hasOwnProperty("backgroundColor")}function l(t){var n=e(t).offset();return[n.left,n.top]}function c(e){return[e.pageX-i[0],e.pageY-i[1]]}function h(t){typeof t!="object"&&(t={}),r=e.extend(r,t),e.each(["onChange","onSelect","onRelease","onDblClick"],function(e,t){typeof r[t]!="function"&&(r[t]=function(){})})}function p(e,t){i=l(L),tt.setCursor(e==="move"?e:e+"-resize");if(e==="move")return tt.activateHandlers(v(t),w);var n=Y.getFixed(),r=m(e),s=Y.getCorner(m(r));Y.setPressed(Y.getCorner(r)),Y.setCurrent(s),tt.activateHandlers(d(e,n),w)}function d(e,t){return function(n){if(!r.aspectRatio)switch(e){case"e":n[1]=t.y2;break;case"w":n[1]=t.y2;break;case"n":n[0]=t.x2;break;case"s":n[0]=t.x2}else switch(e){case"e":n[1]=t.y+1;break;case"w":n[1]=t.y+1;break;case"n":n[0]=t.x+1;break;case"s":n[0]=t.x+1}Y.setCurrent(n),et.update()}}function v(e){var t=e;return nt.watchKeys(),function(e){Y.moveOffset([e[0]-t[0],e[1]-t[1]]),t=e,et.update()}}function m(e){switch(e){case"n":return"sw";case"s":return"nw";case"e":return"nw";case"w":return"ne";case"ne":return"sw";case"nw":return"se";case"se":return"nw";case"sw":return"ne"}}function g(e){return function(t){return r.disabled?!1:e==="move"&&!r.allowMove?!1:(i=l(L),J=!0,p(e,c(t)),t.stopPropagation(),t.preventDefault(),!1)}}function y(e,t,n){var r=e.width(),i=e.height();r>t&&t>0&&(r=t,i=t/e.width()*e.height()),i>n&&n>0&&(i=n,r=n/e.height()*e.width()),W=e.width()/r,X=e.height()/i,e.width(r).height(i)}function b(e){return{x:e.x*W,y:e.y*X,x2:e.x2*W,y2:e.y2*X,w:e.w*W,h:e.h*X}}function w(e){var t=Y.getFixed();t.w>r.minSelect[0]&&t.h>r.minSelect[1]?(et.enableHandles(),et.done()):et.release(),tt.setCursor(r.allowSelect?"crosshair":"default")}function E(e){if(r.disabled)return!1;if(!r.allowSelect)return!1;J=!0,i=l(L),et.disableHandles(),tt.setCursor("crosshair");var t=c(e);return Y.setPressed(t),et.update(),tt.activateHandlers(S,w),nt.watchKeys(),e.stopPropagation(),e.preventDefault(),!1}function S(e){Y.setCurrent(e),et.update()}function x(){var t=e("<div></div>").addClass(a("tracker"));return e.browser.msie&&t.css({opacity:0,backgroundColor:"white"}),t}function rt(e){M.removeClass().addClass(a("holder")).addClass(e)}function it(e,t){function b(){window.setTimeout(w,c)}var n=e[0]/W,i=e[1]/X,s=e[2]/W,o=e[3]/X;if(K)return;var u=Y.flipCoords(n,i,s,o),a=Y.getFixed(),f=[a.x,a.y,a.x2,a.y2],l=f,c=r.animationDelay,h=u[0]-f[0],p=u[1]-f[1],d=u[2]-f[2],v=u[3]-f[3],m=0,g=r.swingSpeed;n=l[0],i=l[1],s=l[2],o=l[3],et.animMode(!0);var y,w=function(){return function(){m+=(100-m)/g,l[0]=Math.round(n+m/100*h),l[1]=Math.round(i+m/100*p),l[2]=Math.round(s+m/100*d),l[3]=Math.round(o+m/100*v),m>=99.8&&(m=100),m<100?(ot(l),b()):(et.done(),et.animMode(!1),typeof t=="function"&&t.call(gt))}}();b()}function st(e){ot([e[0]/W,e[1]/X,e[2]/W,e[3]/X]),r.onSelect.call(gt,b(Y.getFixed())),et.enableHandles()}function ot(e){Y.setPressed([e[0],e[1]]),Y.setCurrent([e[2],e[3]]),et.update()}function ut(){return b(Y.getFixed())}function at(){return Y.getFixed()}function ft(e){h(e),mt()}function lt(){r.disabled=!0,et.disableHandles(),et.setCursor("default"),tt.setCursor("default")}function ct(){r.disabled=!1,mt()}function ht(){et.done(),tt.activateHandlers(null,null)}function pt(){M.remove(),N.show(),e(t).removeData("Jcrop")}function dt(e,t){et.release(),lt();var n=new Image;n.onload=function(){var i=n.width,s=n.height,o=r.boxWidth,u=r.boxHeight;L.width(i).height(s),L.attr("src",e),_.attr("src",e),y(L,o,u),A=L.width(),O=L.height(),_.width(A).height(O),j.width(A+B*2).height(O+B*2),M.width(A).height(O),Z.resize(A,O),ct(),typeof t=="function"&&t.call(gt)},n.src=e}function vt(e,t,n){var i=t||r.bgColor;r.bgFade&&f()&&r.fadeTime&&!n?e.animate({backgroundColor:i},{queue:!1,duration:r.fadeTime}):e.css("backgroundColor",i)}function mt(e){r.allowResize?e?et.enableOnly():et.enableHandles():et.disableHandles(),tt.setCursor(r.allowSelect?"crosshair":"default"),et.setCursor(r.allowMove?"move":"default"),r.hasOwnProperty("trueSize")&&(W=r.trueSize[0]/A,X=r.trueSize[1]/O),r.hasOwnProperty("setSelect")&&(st(r.setSelect),et.done(),delete r.setSelect),Z.refresh(),r.bgColor!=F&&(vt(r.shade?Z.getShades():M,r.shade?r.shadeColor||r.bgColor:r.bgColor),F=r.bgColor),I!=r.bgOpacity&&(I=r.bgOpacity,r.shade?Z.refresh():et.setBgOpacity(I)),q=r.maxSize[0]||0,R=r.maxSize[1]||0,U=r.minSize[0]||0,z=r.minSize[1]||0,r.hasOwnProperty("outerImage")&&(L.attr("src",r.outerImage),delete r.outerImage),et.refresh()}var r=e.extend({},e.Jcrop.defaults),i,s,o=!1;e.browser.msie&&e.browser.version.split(".")[0]==="6"&&(o=!0),typeof t!="object"&&(t=e(t)[0]),typeof n!="object"&&(n={}),h(n);var T={border:"none",visibility:"visible",margin:0,padding:0,position:"absolute",top:0,left:0},N=e(t),C=!0;if(t.tagName=="IMG"){if(N[0].width!=0&&N[0].height!=0)N.width(N[0].width),N.height(N[0].height);else{var k=new Image;k.src=N[0].src,N.width(k.width),N.height(k.height)}var L=N.clone().removeAttr("id").css(T).show();L.width(N.width()),L.height(N.height()),N.after(L).hide()}else L=N.css(T).show(),C=!1,r.shade===null&&(r.shade=!0);y(L,r.boxWidth,r.boxHeight);var A=L.width(),O=L.height(),M=e("<div />").width(A).height(O).addClass(a("holder")).css({position:"relative",backgroundColor:r.bgColor}).insertAfter(N).append(L);r.addClass&&M.addClass(r.addClass);var _=e("<div />"),D=e("<div />").width("100%").height("100%").css({zIndex:310,position:"absolute",overflow:"hidden"}),P=e("<div />").width("100%").height("100%").css("zIndex",320),H=e("<div />").css({position:"absolute",zIndex:600}).dblclick(function(){var e=Y.getFixed();r.onDblClick.call(gt,e)}).insertBefore(L).append(D,P);C&&(_=e("<img />").attr("src",L.attr("src")).css(T).width(A).height(O),D.append(_)),o&&H.css({overflowY:"hidden"});var B=r.boundary,j=x().width(A+B*2).height(O+B*2).css({position:"absolute",top:u(-B),left:u(-B),zIndex:290}).mousedown(E),F=r.bgColor,I=r.bgOpacity,q,R,U,z,W,X,V=!0,J,K,Q;i=l(L);var G=function(){function e(){var e={},t=["touchstart","touchmove","touchend"],n=document.createElement("div"),r;try{for(r=0;r<t.length;r++){var i=t[r];i="on"+i;var s=i in n;s||(n.setAttribute(i,"return;"),s=typeof n[i]=="function"),e[t[r]]=s}return e.touchstart&&e.touchend&&e.touchmove}catch(o){return!1}}function t(){return r.touchSupport===!0||r.touchSupport===!1?r.touchSupport:e()}return{createDragger:function(e){return function(t){return t.pageX=t.originalEvent.changedTouches[0].pageX,t.pageY=t.originalEvent.changedTouches[0].pageY,r.disabled?!1:e==="move"&&!r.allowMove?!1:(J=!0,p(e,c(t)),t.stopPropagation(),t.preventDefault(),!1)}},newSelection:function(e){return e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,E(e)},isSupported:e,support:t()}}(),Y=function(){function u(r){r=p(r),n=e=r[0],i=t=r[1]}function a(e){e=p(e),s=e[0]-n,o=e[1]-i,n=e[0],i=e[1]}function f(){return[s,o]}function l(r){var s=r[0],o=r[1];0>e+s&&(s-=s+e),0>t+o&&(o-=o+t),O<i+o&&(o+=O-(i+o)),A<n+s&&(s+=A-(n+s)),e+=s,n+=s,t+=o,i+=o}function c(e){var t=h();switch(e){case"ne":return[t.x2,t.y];case"nw":return[t.x,t.y];case"se":return[t.x2,t.y2];case"sw":return[t.x,t.y2]}}function h(){if(!r.aspectRatio)return v();var s=r.aspectRatio,o=r.minSize[0]/W,u=r.maxSize[0]/W,a=r.maxSize[1]/X,f=n-e,l=i-t,c=Math.abs(f),h=Math.abs(l),p=c/h,g,y,b,w;return u===0&&(u=A*10),a===0&&(a=O*10),p<s?(y=i,b=h*s,g=f<0?e-b:b+e,g<0?(g=0,w=Math.abs((g-e)/s),y=l<0?t-w:w+t):g>A&&(g=A,w=Math.abs((g-e)/s),y=l<0?t-w:w+t)):(g=n,w=c/s,y=l<0?t-w:t+w,y<0?(y=0,b=Math.abs((y-t)*s),g=f<0?e-b:b+e):y>O&&(y=O,b=Math.abs(y-t)*s,g=f<0?e-b:b+e)),g>e?(g-e<o?g=e+o:g-e>u&&(g=e+u),y>t?y=t+(g-e)/s:y=t-(g-e)/s):g<e&&(e-g<o?g=e-o:e-g>u&&(g=e-u),y>t?y=t+(e-g)/s:y=t-(e-g)/s),g<0?(e-=g,g=0):g>A&&(e-=g-A,g=A),y<0?(t-=y,y=0):y>O&&(t-=y-O,y=O),m(d(e,t,g,y))}function p(e){return e[0]<0&&(e[0]=0),e[1]<0&&(e[1]=0),e[0]>A&&(e[0]=A),e[1]>O&&(e[1]=O),[e[0],e[1]]}function d(e,t,n,r){var i=e,s=n,o=t,u=r;return n<e&&(i=n,s=e),r<t&&(o=r,u=t),[i,o,s,u]}function v(){var r=n-e,s=i-t,o;return q&&Math.abs(r)>q&&(n=r>0?e+q:e-q),R&&Math.abs(s)>R&&(i=s>0?t+R:t-R),z/X&&Math.abs(s)<z/X&&(i=s>0?t+z/X:t-z/X),U/W&&Math.abs(r)<U/W&&(n=r>0?e+U/W:e-U/W),e<0&&(n-=e,e-=e),t<0&&(i-=t,t-=t),n<0&&(e-=n,n-=n),i<0&&(t-=i,i-=i),n>A&&(o=n-A,e-=o,n-=o),i>O&&(o=i-O,t-=o,i-=o),e>A&&(o=e-O,i-=o,t-=o),t>O&&(o=t-O,i-=o,t-=o),m(d(e,t,n,i))}function m(e){return{x:e[0],y:e[1],x2:e[2],y2:e[3],w:e[2]-e[0],h:e[3]-e[1]}}var e=0,t=0,n=0,i=0,s,o;return{flipCoords:d,setPressed:u,setCurrent:a,getOffset:f,moveOffset:l,getCorner:c,getFixed:h}}(),Z=function(){function s(e,t){i.left.css({height:u(t)}),i.right.css({height:u(t)})}function o(){return a(Y.getFixed())}function a(e){i.top.css({left:u(e.x),width:u(e.w),height:u(e.y)}),i.bottom.css({top:u(e.y2),left:u(e.x),width:u(e.w),height:u(O-e.y2)}),i.right.css({left:u(e.x2),width:u(A-e.x2)}),i.left.css({width:u(e.x)})}function f(){return e("<div />").css({position:"absolute",backgroundColor:r.shadeColor||r.bgColor}).appendTo(n)}function l(){t||(t=!0,n.insertBefore(L),o(),et.setBgOpacity(1,0,1),_.hide(),c(r.shadeColor||r.bgColor,1),et.isAwake()?p(r.bgOpacity,1):p(1,1))}function c(e,t){vt(v(),e,t)}function h(){t&&(n.remove(),_.show(),t=!1,et.isAwake()?et.setBgOpacity(r.bgOpacity,1,1):(et.setBgOpacity(1,1,1),et.disableHandles()),vt(M,0,1))}function p(e,i){t&&(r.bgFade&&!i?n.animate({opacity:1-e},{queue:!1,duration:r.fadeTime}):n.css({opacity:1-e}))}function d(){r.shade?l():h(),et.isAwake()&&p(r.bgOpacity)}function v(){return n.children()}var t=!1,n=e("<div />").css({position:"absolute",zIndex:240,opacity:0}),i={top:f(),left:f().height(O),right:f().height(O),bottom:f()};return{update:o,updateRaw:a,getShades:v,setBgColor:c,enable:l,disable:h,resize:s,refresh:d,opacity:p}}(),et=function(){function l(t){var n=e("<div />").css({position:"absolute",opacity:r.borderOpacity}).addClass(a(t));return D.append(n),n}function c(t,n){var r=e("<div />").mousedown(g(t)).css({cursor:t+"-resize",position:"absolute",zIndex:n}).addClass("ord-"+t);return G.support&&r.bind("touchstart.jcrop",G.createDragger(t)),P.append(r),r}function h(e){var t=r.handleSize;return c(e,n++).css({opacity:r.handleOpacity}).width(t).height(t).addClass(a("handle"))}function p(e){return c(e,n++).addClass("jcrop-dragbar")}function d(e){var t;for(t=0;t<e.length;t++)o[e[t]]=p(e[t])}function v(e){var t,n;for(n=0;n<e.length;n++){switch(e[n]){case"n":t="hline";break;case"s":t="hline bottom";break;case"e":t="vline right";break;case"w":t="vline"}i[e[n]]=l(t)}}function m(e){var t;for(t=0;t<e.length;t++)s[e[t]]=h(e[t])}function y(e,t){r.shade||_.css({top:u(-t),left:u(-e)}),H.css({top:u(t),left:u(e)})}function w(e,t){H.width(Math.round(e)).height(Math.round(t))}function E(){var e=Y.getFixed();Y.setPressed([e.x,e.y]),Y.setCurrent([e.x2,e.y2]),S()}function S(e){if(t)return T(e)}function T(e){var n=Y.getFixed();w(n.w,n.h),y(n.x,n.y),r.shade&&Z.updateRaw(n),t||C(),e?r.onSelect.call(gt,b(n)):r.onChange.call(gt,b(n))}function N(e,n,i){if(!t&&!n)return;r.bgFade&&!i?L.animate({opacity:e},{queue:!1,duration:r.fadeTime}):L.css("opacity",e)}function C(){H.show(),r.shade?Z.opacity(I):N(I,!0),t=!0}function k(){M(),H.hide(),r.shade?Z.opacity(1):N(1),t=!1,r.onRelease.call(gt)}function A(){f&&P.show()}function O(){f=!0;if(r.allowResize)return P.show(),!0}function M(){f=!1,P.hide()}function B(e){e?(K=!0,M()):(K=!1,O())}function j(){B(!1),E()}var t,n=370,i={},s={},o={},f=!1;r.dragEdges&&e.isArray(r.createDragbars)&&d(r.createDragbars),e.isArray(r.createHandles)&&m(r.createHandles),r.drawBorders&&e.isArray(r.createBorders)&&v(r.createBorders),e(document).bind("touchstart.jcrop-ios",function(t){e(t.currentTarget).hasClass("jcrop-tracker")&&t.stopPropagation()});var F=x().mousedown(g("move")).css({cursor:"move",position:"absolute",zIndex:360});return G.support&&F.bind("touchstart.jcrop",G.createDragger("move")),D.append(F),M(),{updateVisible:S,update:T,release:k,refresh:E,isAwake:function(){return t},setCursor:function(e){F.css("cursor",e)},enableHandles:O,enableOnly:function(){f=!0},showHandles:A,disableHandles:M,animMode:B,setBgOpacity:N,done:j}}(),tt=function(){function s(){j.css({zIndex:450}),G.support&&e(document).bind("touchmove.jcrop",l).bind("touchend.jcrop",h),i&&e(document).bind("mousemove.jcrop",u).bind("mouseup.jcrop",a)}function o(){j.css({zIndex:290}),e(document).unbind(".jcrop")}function u(e){return t(c(e)),!1}function a(e){return e.preventDefault(),e.stopPropagation(),J&&(J=!1,n(c(e)),et.isAwake()&&r.onSelect.call(gt,b(Y.getFixed())),o(),t=function(){},n=function(){}),!1}function f(e,r){return J=!0,t=e,n=r,s(),!1}function l(e){return e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,u(e)}function h(e){return e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,a(e)}function p(e){j.css("cursor",e)}var t=function(){},n=function(){},i=r.trackDocument;return i||j.mousemove(u).mouseup(a).mouseout(a),L.before(j),{activateHandlers:f,setCursor:p}}(),nt=function(){function i(){r.keySupport&&(t.show(),t.focus())}function s(e){t.hide()}function u(e,t,n){r.allowMove&&(Y.moveOffset([t,n]),et.updateVisible(!0)),e.preventDefault(),e.stopPropagation()}function a(e){if(e.ctrlKey||e.metaKey)return!0;Q=e.shiftKey?!0:!1;var t=Q?10:1;switch(e.keyCode){case 37:u(e,-t,0);break;case 39:u(e,t,0);break;case 38:u(e,0,-t);break;case 40:u(e,0,t);break;case 27:r.allowSelect&&et.release();break;case 9:return!0}return!1}var t=e('<input type="radio" />').css({position:"fixed",left:"-120px",width:"12px"}).addClass("jcrop-keymgr"),n=e("<div />").css({position:"absolute",overflow:"hidden"}).append(t);return r.keySupport&&(t.keydown(a).blur(s),o||!r.fixedSupport?(t.css({position:"absolute",left:"-20px"}),n.append(t).insertBefore(L)):t.insertBefore(L)),{watchKeys:i}}();G.support&&j.bind("touchstart.jcrop",G.newSelection),P.hide(),mt(!0);var gt={setImage:dt,animateTo:it,setSelect:st,setOptions:ft,tellSelect:ut,tellScaled:at,setClass:rt,disable:lt,enable:ct,cancel:ht,release:et.release,destroy:pt,focus:nt.watchKeys,getBounds:function(){return[A*W,O*X]},getWidgetSize:function(){return[A,O]},getScaleFactor:function(){return[W,X]},getOptions:function(){return r},ui:{holder:M,selection:H}};return e.browser.msie&&M.bind("selectstart",function(){return!1}),N.data("Jcrop",gt),gt},e.fn.Jcrop=function(t,n){var r;return this.each(function(){if(e(this).data("Jcrop")){if(t==="api")return e(this).data("Jcrop");e(this).data("Jcrop").setOptions(t)}else this.tagName=="IMG"?e.Jcrop.Loader(this,function(){e(this).css({display:"block",visibility:"hidden"}),r=e.Jcrop(this,t),e.isFunction(n)&&n.call(r)}):(e(this).css({display:"block",visibility:"hidden"}),r=e.Jcrop(this,t),e.isFunction(n)&&n.call(r))}),this},e.Jcrop.Loader=function(t,n,r){function o(){s.complete?(i.unbind(".jcloader"),e.isFunction(n)&&n.call(s)):window.setTimeout(o,50)}var i=e(t),s=i[0];i.bind("load.jcloader",o).bind("error.jcloader",function(t){i.unbind(".jcloader"),e.isFunction(r)&&r.call(s)}),s.complete&&e.isFunction(n)&&(i.unbind(".jcloader"),n.call(s))},e.Jcrop.defaults={allowSelect:!0,allowMove:!0,allowResize:!0,trackDocument:!0,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:.6,bgFade:!1,borderOpacity:.4,handleOpacity:.5,handleSize:7,aspectRatio:0,keySupport:!0,createHandles:["n","s","e","w","nw","ne","se","sw"],createDragbars:["n","s","e","w"],createBorders:["n","s","e","w"],drawBorders:!0,dragEdges:!0,fixedSupport:!0,touchSupport:null,shade:null,boxWidth:0,boxHeight:0,boundary:2,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},onDblClick:function(){},onRelease:function(){}}});